function jString(e){return JSON.stringify(e)}function jParse(e){return JSON.parse(e)}function randomId(){for(var e="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=0;5>n;n++)e+=t.charAt(Math.floor(Math.random()*t.length));return e}function findIndexOf(e,t){var n=0,o=t.length;for(n;o>n;n++)if(t[n].objId===e)return n}var $$={iptFld:document.getElementById("inputField"),iptBtn:document.getElementById("inputBtn"),projCont:document.getElementById("projectsContainer"),projTpl:document.getElementById("projectTemplate"),noProj:document.getElementById("noProject")},projects=[],dbConnect=function(){localStorage?(console.log("yes, there is localStorage API"),null===localStorage||0===localStorage.length?(console.info("creating db"),localStorage.setItem("projects","[]"),projects=jParse(localStorage.getItem("projects"))):(console.info("DB is here"),projects=jParse(localStorage.getItem("projects")))):alert("XXX no localStorage, update your browser now XXX")},initialRender=function(){for(var e=projects.length,t=0;e>t;t++){var n=new Model(projects[t].objId,projects[t].title,projects[t].progress,projects);new View(n).init()}},bindEvents=function(){$$.iptBtn.addEventListener("click",function(){var e=$$.iptFld.value;if(e.length>2){var t=new Model(void 0,e,0,projects).save();new View(t).init(),$$.iptFld.value=""}else alert("This is not acceptable")})},init=function(){dbConnect(),initialRender(),bindEvents()};window.addEventListener("DOMContentLoaded",init);var Model=function(e,t,n,o){return this.id=e||randomId(),this.title=t,this.progress=n,this.save=function(){o.push({objId:this.id,title:this.title,progress:this.progress});var e=jString(o);return localStorage.setItem("projects",e),this},this.changeProgress=function(e,t){this.progress=e,console.log(findIndexOf(this.id,o)),o[findIndexOf(this.id,o)].progress=this.progress,localStorage.setItem("projects",jString(projects)),t()},this.remove=function(e){console.log("removing",this.title),o=o.splice(findIndexOf(this.id,o),1),localStorage.setItem("projects",jString(projects)),e()},this},View=function(e){this.model=e;var t=this;this.render=function(){return console.info("rendering view"),$$.noProj.classList.add("hidden"),this.item=$$.projTpl.cloneNode(!0),this.item.querySelectorAll("span")[0].innerText=this.model.title,console.log("View tells: "+this.model.progress),this.item.querySelectorAll("span")[1].innerText=this.model.progress,this.item.querySelector("input").setAttribute("value",this.model.progress),this.item.classList.remove("hidden"),$$.projCont.insertBefore(this.item,$$.projCont.firstChild),this},this.bindEvents=function(){this.item.querySelector("a").addEventListener("click",function(){t.remove()}),this.item.querySelector("input").addEventListener("change",function(e){t.changeProgress(e.srcElement.value)})},this.changeProgress=function(n){e.changeProgress(n,function(){t.item.querySelectorAll("span")[1].innerText=n})},this.remove=function(){e.remove(function(){t.item.remove()}),0===projects.length&&$$.noProj.classList.remove("hidden")},this.init=function(){this.render(),this.bindEvents()}};